#!/usr/bin/env ruby

require 'thor'
require 'lobstr'

class Lob < Thor
  desc "deploy TARGET", "lobs code at the branch and environment you specify"
  long_desc "lobs code at the branch and environment you specify, separated by @
  \n\n 
  Example: lob deploy master@production"  
  def deploy(target='master@production')
    lobstr = Lobstr::Deploy.new
    branch,env = lobstr.parse_target(target)

    say "deploying #{set_color(branch,:yellow)} to #{set_color(env, :yellow)}"
  end
  default_task :deploy
end

begin
  ENV['THOR_DEBUG'] = '1'
  Lob.start 
rescue Thor::UndefinedTaskError => e
  if ARGV[0] =~ /@/
    Lob.new.invoke(:deploy, ARGV)
  else
    puts e.message
  end
rescue => e
  ENV['THOR_DEBUG'] = '0'
  raise e
end
